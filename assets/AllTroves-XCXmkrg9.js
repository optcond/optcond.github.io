import{j as e}from"./query-Df61bAsc.js";import{r as n}from"./react-uYZGv8Ap.js";import{l as O,C as z,I as M,b as c,B as p}from"./index-DevYselH.js";import{V,j as E,D as $,k as _,l as k,m as F,n as W,o as L}from"./lucide-DPiKxmDp.js";import"./recharts-wdVATIY2.js";import"./supabase-CskpBK-R.js";const D=r=>r.length<=12?r:`${r.slice(0,8)}...${r.slice(-6)}`,Q=({troves:r,isLoading:A})=>{const{toast:d}=O(),[u,R]=n.useState(""),[l,T]=n.useState("all"),[m,U]=n.useState("collaterization_ratio"),[j,w]=n.useState("asc"),[a,B]=n.useState(new Set(JSON.parse(localStorage.getItem("troveWatchlist")||"[]"))),v=t=>{const s=new Set(a);s.has(t)?(s.delete(t),d({title:"Removed from watchlist"})):(s.add(t),d({title:"Added to watchlist"})),B(s),localStorage.setItem("troveWatchlist",JSON.stringify([...s]))},x=n.useMemo(()=>{let t=r;return u&&(t=t.filter(s=>s.owner.toLowerCase().includes(u.toLowerCase()))),l==="critical"?t=t.filter(s=>s.collaterization_ratio<1.2):l==="high"?t=t.filter(s=>s.collaterization_ratio>=1.2&&s.collaterization_ratio<1.6):l==="medium"?t=t.filter(s=>s.collaterization_ratio>=1.6&&s.collaterization_ratio<2):l==="safe"?t=t.filter(s=>s.collaterization_ratio>=2):l==="watchlist"&&(t=t.filter(s=>a.has(s.owner))),t.sort((s,b)=>{const h=s[m],f=b[m],o=j==="asc"?1:-1;return typeof h=="string"&&typeof f=="string"?h.localeCompare(f)*o:(h-f)*o}),t},[r,u,l,m,j,a]),C=t=>t<1.2?"text-critical":t<1.6?"text-high":t<2?"text-elevated":"text-safe",y=t=>t<1.2?e.jsx(p,{variant:"destructive",children:"Critical"}):t<1.6?e.jsx(p,{className:"bg-high text-white",children:"High"}):t<2?e.jsx(p,{className:"bg-elevated text-black",children:"Elevated"}):e.jsx(p,{className:"bg-safe text-white",children:"Safe"}),g=t=>{m===t?w(j==="asc"?"desc":"asc"):(U(t),w("asc"))},I=()=>{const t=["Owner","Collateral (BTC)","Debt (MUSD)","Interest (MUSD)","CR"],s=x.map(i=>[i.owner,i.collateral.toFixed(8),i.principal_debt.toFixed(2),i.interest.toFixed(2),i.collaterization_ratio.toFixed(4)]),b=[t,...s].map(i=>i.join(",")).join(`
`),h=new Blob([b],{type:"text/csv"}),f=URL.createObjectURL(h),o=document.createElement("a");o.href=f,o.download="troves.csv",o.click(),d({title:"CSV exported successfully"})},S=async t=>{try{await navigator.clipboard.writeText(t),d({title:"Address copied"})}catch{d({title:"Failed to copy address",variant:"destructive"})}},N=({field:t})=>m!==t?null:j==="asc"?e.jsx(W,{className:"h-4 w-4"}):e.jsx(L,{className:"h-4 w-4"});return A?e.jsxs(z,{className:"glass-card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"All Troves"}),e.jsx("div",{className:"h-96 bg-muted/20 animate-pulse rounded-xl"})]}):e.jsxs(z,{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-primary",children:[e.jsx(V,{className:"h-5 w-5 text-primary"}),"All Troves"]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 w-full",children:[e.jsx(E,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(M,{placeholder:"Search owner address...",value:u,onChange:t=>R(t.target.value),className:"pl-9"})]}),e.jsxs(c,{onClick:I,variant:"outline",className:"w-full gap-2 sm:w-auto",children:[e.jsx($,{className:"h-4 w-4"}),"CSV"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["all","critical","high","medium","safe","watchlist"].map(t=>e.jsxs(c,{variant:l===t?"default":"outline",size:"sm",onClick:()=>T(t),className:"capitalize",children:[t,t==="watchlist"&&a.size>0&&e.jsx(p,{variant:"secondary",className:"ml-2",children:a.size})]},t))})]}),e.jsx("div",{className:"hidden md:block border border-card-border/40 rounded-xl overflow-hidden",children:e.jsxs("div",{className:"max-h-[560px] overflow-y-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-card-border",children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold",children:e.jsxs("button",{onClick:()=>g("owner"),className:"flex items-center gap-1 hover:text-primary transition-smooth",children:["Owner",e.jsx(N,{field:"owner"})]})}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold",children:e.jsxs("button",{onClick:()=>g("collateral"),className:"flex items-center gap-1 ml-auto hover:text-primary transition-smooth",children:["Collateral",e.jsx(N,{field:"collateral"})]})}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold",children:e.jsxs("button",{onClick:()=>g("principal_debt"),className:"flex items-center gap-1 ml-auto hover:text-primary transition-smooth",children:["Debt",e.jsx(N,{field:"principal_debt"})]})}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold",children:"Interest"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold",children:e.jsxs("button",{onClick:()=>g("collaterization_ratio"),className:"flex items-center gap-1 ml-auto hover:text-primary transition-smooth",children:["CR",e.jsx(N,{field:"collaterization_ratio"})]})}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold",children:"Health"})]})}),e.jsx("tbody",{children:x.map(t=>e.jsxs("tr",{className:"border-b border-card-border/40 hover:bg-card/30 transition-smooth",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:`https://explorer.mezo.org/address/${t.owner}`,target:"_blank",rel:"noopener noreferrer",className:"font-mono text-sm text-primary hover:underline break-all",children:D(t.owner)}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground",onClick:()=>S(t.owner),"aria-label":"Copy address",children:e.jsx(_,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>v(t.owner),className:"h-7 w-7","aria-label":a.has(t.owner)?"Remove from watchlist":"Add to watchlist",children:a.has(t.owner)?e.jsx(k,{className:"h-4 w-4 text-primary"}):e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})})]})]})}),e.jsxs("td",{className:"p-3 text-right font-medium",children:[t.collateral.toFixed(4)," BTC"]}),e.jsxs("td",{className:"p-3 text-right",children:[t.principal_debt.toFixed(2)," MUSD"]}),e.jsxs("td",{className:"p-3 text-right text-sm text-muted-foreground",children:[t.interest.toFixed(2)," MUSD"]}),e.jsxs("td",{className:`p-3 text-right font-bold ${C(t.collaterization_ratio)}`,children:[(t.collaterization_ratio*100).toFixed(1),"%"]}),e.jsx("td",{className:"p-3 text-center",children:y(t.collaterization_ratio)})]},t.id))})]}),x.length===0&&e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No troves found. Adjust filters or verify Supabase seed."})]})}),e.jsxs("div",{className:"space-y-3 md:hidden",children:[x.map(t=>e.jsxs("div",{className:"p-4 rounded-lg bg-card/30 border border-card-border/40",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3 gap-3",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:`https://explorer.mezo.org/address/${t.owner}`,target:"_blank",rel:"noopener noreferrer",className:"font-mono text-sm text-primary hover:underline break-all",children:D(t.owner)}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground",onClick:()=>S(t.owner),"aria-label":"Copy address",children:e.jsx(_,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>v(t.owner),className:"h-7 w-7","aria-label":a.has(t.owner)?"Remove from watchlist":"Add to watchlist",children:a.has(t.owner)?e.jsx(k,{className:"h-4 w-4 text-primary"}):e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})})]})]})}),y(t.collaterization_ratio)]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm mb-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Collateral:"})," ",e.jsxs("span",{className:"font-medium",children:[t.collateral.toFixed(4)," BTC"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Debt:"})," ",e.jsxs("span",{className:"font-medium",children:[t.principal_debt.toFixed(2)," MUSD"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Interest:"})," ",e.jsxs("span",{children:[t.interest.toFixed(2)," MUSD"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"CR:"})," ",e.jsxs("span",{className:`font-bold ${C(t.collaterization_ratio)}`,children:[(t.collaterization_ratio*100).toFixed(1),"%"]})]})]})]},t.id)),x.length===0&&e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No troves found. Adjust filters or verify Supabase seed."})]})]})};export{Q as AllTroves};
