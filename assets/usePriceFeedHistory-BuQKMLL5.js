import{r as g}from"./react-uYZGv8Ap.js";import{u as y}from"./query-CpGXJd7o.js";import{s as b}from"./index-WCnWGAth.js";const _=60*60*1e3,w=5e3,P=async({source:s,hours:n,limit:c})=>{const t=new Date(Date.now()-n*_).toISOString(),{data:i,error:o}=await b.from("price_feeds").select("*").eq("source",s).gte("recorded_at",t).order("recorded_at",{ascending:!0}).limit(c??w);if(o)throw new Error(o.message);return i??[]},M=({source:s,hours:n,limit:c})=>{const t=y({queryKey:["price-feed-history",s,n,c],queryFn:()=>P({source:s,hours:n,limit:c}),refetchInterval:6e5,staleTime:3e4,refetchOnWindowFocus:!0,retry:1}),{points:i,stats:o}=g.useMemo(()=>{var m;const e=((m=t.data)==null?void 0:m.map(r=>({timestamp:r.recorded_at,blockNumber:r.block_number,price:r.price})))??[];if(e.length===0)return{points:e,stats:{latestPrice:null,change:null,percentChange:null,high:null,low:null,latestBlockNumber:null,lastUpdated:null}};const l=e[0],a=e[e.length-1],p=e.map(r=>r.price),d=Math.max(...p),h=Math.min(...p),u=a.price-l.price,f=l.price!==0?u/l.price*100:null;return{points:e,stats:{latestPrice:a.price,change:u,percentChange:f,high:d,low:h,latestBlockNumber:a.blockNumber,lastUpdated:a.timestamp}}},[t.data]);return{...t,pricePoints:i,stats:o}};export{M as u};
