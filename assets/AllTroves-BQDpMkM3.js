import{j as e}from"./query-CpGXJd7o.js";import{r as c}from"./react-uYZGv8Ap.js";import{u as M,C as z,I as V,b as d,B as p}from"./index-B9GtemhO.js";import{f as i}from"./formatNumber-BiSiC57o.js";import{V as E,g as $,D as W,h as F,i as _,j as k,k as L,l as H}from"./lucide-CZieGwRX.js";import"./supabase-CskpBK-R.js";import"./recharts-CblCIUsG.js";const A=r=>r.length<=12?r:`${r.slice(0,8)}...${r.slice(-6)}`,Y=({troves:r,isLoading:R})=>{const{toast:m}=M(),[g,T]=c.useState(""),[l,U]=c.useState("all"),[x,B]=c.useState("collaterization_ratio"),[j,v]=c.useState("asc"),[a,I]=c.useState(new Set(JSON.parse(localStorage.getItem("troveWatchlist")||"[]"))),C=t=>{const s=new Set(a);s.has(t)?(s.delete(t),m({title:"Removed from watchlist"})):(s.add(t),m({title:"Added to watchlist"})),I(s),localStorage.setItem("troveWatchlist",JSON.stringify([...s]))},h=c.useMemo(()=>{let t=r;return g&&(t=t.filter(s=>s.owner.toLowerCase().includes(g.toLowerCase()))),l==="critical"?t=t.filter(s=>s.collaterization_ratio<1.2):l==="high"?t=t.filter(s=>s.collaterization_ratio>=1.2&&s.collaterization_ratio<1.6):l==="medium"?t=t.filter(s=>s.collaterization_ratio>=1.6&&s.collaterization_ratio<2):l==="safe"?t=t.filter(s=>s.collaterization_ratio>=2):l==="watchlist"&&(t=t.filter(s=>a.has(s.owner))),t.sort((s,w)=>{const u=s[x],f=w[x],n=j==="asc"?1:-1;return typeof u=="string"&&typeof f=="string"?u.localeCompare(f)*n:(u-f)*n}),t},[r,g,l,x,j,a]),y=t=>t<1.2?"text-critical":t<1.6?"text-high":t<2?"text-elevated":"text-safe",S=t=>t<1.2?e.jsx(p,{variant:"destructive",children:"Critical"}):t<1.6?e.jsx(p,{className:"bg-high text-white",children:"High"}):t<2?e.jsx(p,{className:"bg-elevated text-black",children:"Elevated"}):e.jsx(p,{className:"bg-safe text-white",children:"Safe"}),N=t=>{x===t?v(j==="asc"?"desc":"asc"):(B(t),v("asc"))},O=()=>{const t=["Owner","Collateral (BTC)","Debt (MUSD)","Interest (MUSD)","CR"],s=h.map(o=>[o.owner,o.collateral.toFixed(8),o.principal_debt.toFixed(2),o.interest.toFixed(2),o.collaterization_ratio.toFixed(4)]),w=[t,...s].map(o=>o.join(",")).join(`
`),u=new Blob([w],{type:"text/csv"}),f=URL.createObjectURL(u),n=document.createElement("a");n.href=f,n.download="troves.csv",n.click(),m({title:"CSV exported successfully"})},D=async t=>{try{await navigator.clipboard.writeText(t),m({title:"Address copied"})}catch{m({title:"Failed to copy address",variant:"destructive"})}},b=({field:t})=>x!==t?null:j==="asc"?e.jsx(L,{className:"h-4 w-4"}):e.jsx(H,{className:"h-4 w-4"});return R?e.jsxs(z,{className:"glass-card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"All Troves"}),e.jsx("div",{className:"h-96 bg-muted/20 animate-pulse rounded-xl"})]}):e.jsxs(z,{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-primary",children:[e.jsx(E,{className:"h-5 w-5 text-primary"}),"All Troves"]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 w-full",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search owner address...",value:g,onChange:t=>T(t.target.value),className:"pl-9"})]}),e.jsxs(d,{onClick:O,variant:"outline",className:"w-full gap-2 sm:w-auto",children:[e.jsx(W,{className:"h-4 w-4"}),"CSV"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["all","critical","high","medium","safe","watchlist"].map(t=>e.jsxs(d,{variant:l===t?"default":"outline",size:"sm",onClick:()=>U(t),className:"capitalize",children:[t,t==="watchlist"&&a.size>0&&e.jsx(p,{variant:"secondary",className:"ml-2",children:i(a.size)})]},t))})]}),e.jsx("div",{className:"hidden md:block border border-card-border/40 rounded-xl overflow-hidden",children:e.jsxs("div",{className:"max-h-[560px] overflow-y-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-card-border",children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold",children:e.jsxs("button",{onClick:()=>N("owner"),className:"flex items-center gap-1 hover:text-primary transition-smooth",children:["Owner",e.jsx(b,{field:"owner"})]})}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold",children:e.jsxs("button",{onClick:()=>N("collateral"),className:"flex items-center gap-1 ml-auto hover:text-primary transition-smooth",children:["Collateral",e.jsx(b,{field:"collateral"})]})}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold",children:e.jsxs("button",{onClick:()=>N("principal_debt"),className:"flex items-center gap-1 ml-auto hover:text-primary transition-smooth",children:["Debt",e.jsx(b,{field:"principal_debt"})]})}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold",children:"Interest"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold",children:e.jsxs("button",{onClick:()=>N("collaterization_ratio"),className:"flex items-center gap-1 ml-auto hover:text-primary transition-smooth",children:["CR",e.jsx(b,{field:"collaterization_ratio"})]})}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold",children:"Health"})]})}),e.jsx("tbody",{children:h.map(t=>e.jsxs("tr",{className:"border-b border-card-border/40 hover:bg-card/30 transition-smooth",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:`https://explorer.mezo.org/address/${t.owner}`,target:"_blank",rel:"noopener noreferrer",className:"font-mono text-sm text-primary hover:underline break-all",children:A(t.owner)}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(d,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground",onClick:()=>D(t.owner),"aria-label":"Copy address",children:e.jsx(F,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>C(t.owner),className:"h-7 w-7","aria-label":a.has(t.owner)?"Remove from watchlist":"Add to watchlist",children:a.has(t.owner)?e.jsx(_,{className:"h-4 w-4 text-primary"}):e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})})]})]})}),e.jsxs("td",{className:"p-3 text-right font-medium",children:[i(t.collateral,{minimumFractionDigits:4,maximumFractionDigits:4})," ","BTC"]}),e.jsxs("td",{className:"p-3 text-right",children:[i(t.principal_debt,{minimumFractionDigits:2,maximumFractionDigits:2})," ","MUSD"]}),e.jsxs("td",{className:"p-3 text-right text-sm text-muted-foreground",children:[i(t.interest,{minimumFractionDigits:2,maximumFractionDigits:2})," ","MUSD"]}),e.jsxs("td",{className:`p-3 text-right font-bold ${y(t.collaterization_ratio)}`,children:[i(t.collaterization_ratio*100,{minimumFractionDigits:1,maximumFractionDigits:1}),"%"]}),e.jsx("td",{className:"p-3 text-center",children:S(t.collaterization_ratio)})]},t.id))})]}),h.length===0&&e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No troves found. Adjust filters or verify Supabase seed."})]})}),e.jsxs("div",{className:"space-y-3 md:hidden",children:[h.map(t=>e.jsxs("div",{className:"p-4 rounded-lg bg-card/30 border border-card-border/40",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3 gap-3",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:`https://explorer.mezo.org/address/${t.owner}`,target:"_blank",rel:"noopener noreferrer",className:"font-mono text-sm text-primary hover:underline break-all",children:A(t.owner)}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(d,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground",onClick:()=>D(t.owner),"aria-label":"Copy address",children:e.jsx(F,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>C(t.owner),className:"h-7 w-7","aria-label":a.has(t.owner)?"Remove from watchlist":"Add to watchlist",children:a.has(t.owner)?e.jsx(_,{className:"h-4 w-4 text-primary"}):e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})})]})]})}),S(t.collaterization_ratio)]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm mb-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Collateral:"})," ",e.jsxs("span",{className:"font-medium",children:[i(t.collateral,{minimumFractionDigits:4,maximumFractionDigits:4})," ","BTC"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Debt:"})," ",e.jsxs("span",{className:"font-medium",children:[i(t.principal_debt,{minimumFractionDigits:2,maximumFractionDigits:2})," ","MUSD"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Interest:"})," ",e.jsxs("span",{children:[i(t.interest,{minimumFractionDigits:2,maximumFractionDigits:2})," ","MUSD"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"CR:"})," ",e.jsxs("span",{className:`font-bold ${y(t.collaterization_ratio)}`,children:[i(t.collaterization_ratio*100,{minimumFractionDigits:1,maximumFractionDigits:1}),"%"]})]})]})]},t.id)),h.length===0&&e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No troves found. Adjust filters or verify Supabase seed."})]})]})};export{Y as AllTroves};
