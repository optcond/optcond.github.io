import{j as e}from"./query-Df61bAsc.js";import{r as n}from"./react-uYZGv8Ap.js";import{l as O,C as y,I as R,b as N,B as h}from"./index-CYfbQssv.js";import{V as T,j as W,D as M,k as z,l as _,m as V,n as E}from"./lucide-fc_sQejf.js";import"./recharts-wdVATIY2.js";import"./supabase-CskpBK-R.js";const F=a=>a.length<=12?a:`${a.slice(0,8)}...${a.slice(-6)}`,G=({troves:a,isLoading:k})=>{const{toast:g}=O(),[f,D]=n.useState(""),[l,U]=n.useState("all"),[c,A]=n.useState("collaterization_ratio"),[u,w]=n.useState("asc"),[r,B]=n.useState(new Set(JSON.parse(localStorage.getItem("troveWatchlist")||"[]"))),v=t=>{const s=new Set(r);s.has(t)?(s.delete(t),g({title:"Removed from watchlist"})):(s.add(t),g({title:"Added to watchlist"})),B(s),localStorage.setItem("troveWatchlist",JSON.stringify([...s]))},d=n.useMemo(()=>{let t=a;return f&&(t=t.filter(s=>s.owner.toLowerCase().includes(f.toLowerCase()))),l==="critical"?t=t.filter(s=>s.collaterization_ratio<1.2):l==="high"?t=t.filter(s=>s.collaterization_ratio>=1.2&&s.collaterization_ratio<1.6):l==="medium"?t=t.filter(s=>s.collaterization_ratio>=1.6&&s.collaterization_ratio<2):l==="safe"?t=t.filter(s=>s.collaterization_ratio>=2):l==="watchlist"&&(t=t.filter(s=>r.has(s.owner))),t.sort((s,b)=>{const m=s[c],x=b[c],o=u==="asc"?1:-1;return typeof m=="string"&&typeof x=="string"?m.localeCompare(x)*o:(m-x)*o}),t},[a,f,l,c,u,r]),C=t=>t<1.2?"text-critical":t<1.6?"text-high":t<2?"text-elevated":"text-safe",S=t=>t<1.2?e.jsx(h,{variant:"destructive",children:"Critical"}):t<1.6?e.jsx(h,{className:"bg-high text-white",children:"High"}):t<2?e.jsx(h,{className:"bg-elevated text-black",children:"Elevated"}):e.jsx(h,{className:"bg-safe text-white",children:"Safe"}),j=t=>{c===t?w(u==="asc"?"desc":"asc"):(A(t),w("asc"))},I=()=>{const t=["Owner","Collateral (BTC)","Debt (MUSD)","Interest (MUSD)","CR"],s=d.map(i=>[i.owner,i.collateral.toFixed(8),i.principal_debt.toFixed(2),i.interest.toFixed(2),i.collaterization_ratio.toFixed(4)]),b=[t,...s].map(i=>i.join(",")).join(`
`),m=new Blob([b],{type:"text/csv"}),x=URL.createObjectURL(m),o=document.createElement("a");o.href=x,o.download="troves.csv",o.click(),g({title:"CSV exported successfully"})},p=({field:t})=>c!==t?null:u==="asc"?e.jsx(V,{className:"h-4 w-4"}):e.jsx(E,{className:"h-4 w-4"});return k?e.jsxs(y,{className:"glass-card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"All Troves"}),e.jsx("div",{className:"h-96 bg-muted/20 animate-pulse rounded-xl"})]}):e.jsxs(y,{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-primary",children:[e.jsx(T,{className:"h-5 w-5 text-primary"}),"All Troves"]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 w-full",children:[e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(R,{placeholder:"Search owner address...",value:f,onChange:t=>D(t.target.value),className:"pl-9"})]}),e.jsxs(N,{onClick:I,variant:"outline",className:"w-full gap-2 sm:w-auto",children:[e.jsx(M,{className:"h-4 w-4"}),"CSV"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["all","critical","high","medium","safe","watchlist"].map(t=>e.jsxs(N,{variant:l===t?"default":"outline",size:"sm",onClick:()=>U(t),className:"capitalize",children:[t,t==="watchlist"&&r.size>0&&e.jsx(h,{variant:"secondary",className:"ml-2",children:r.size})]},t))})]}),e.jsx("div",{className:"hidden md:block border border-card-border/40 rounded-xl overflow-hidden",children:e.jsxs("div",{className:"max-h-[560px] overflow-y-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-card-border",children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold",children:e.jsxs("button",{onClick:()=>j("owner"),className:"flex items-center gap-1 hover:text-primary transition-smooth",children:["Owner",e.jsx(p,{field:"owner"})]})}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold",children:e.jsxs("button",{onClick:()=>j("collateral"),className:"flex items-center gap-1 ml-auto hover:text-primary transition-smooth",children:["Collateral",e.jsx(p,{field:"collateral"})]})}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold",children:e.jsxs("button",{onClick:()=>j("principal_debt"),className:"flex items-center gap-1 ml-auto hover:text-primary transition-smooth",children:["Debt",e.jsx(p,{field:"principal_debt"})]})}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold",children:"Interest"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold",children:e.jsxs("button",{onClick:()=>j("collaterization_ratio"),className:"flex items-center gap-1 ml-auto hover:text-primary transition-smooth",children:["CR",e.jsx(p,{field:"collaterization_ratio"})]})}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold",children:"Health"}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold",children:"Watch"})]})}),e.jsx("tbody",{children:d.map(t=>e.jsxs("tr",{className:"border-b border-card-border/40 hover:bg-card/30 transition-smooth",children:[e.jsx("td",{className:"p-3 font-mono text-sm",children:F(t.owner)}),e.jsxs("td",{className:"p-3 text-right font-medium",children:[t.collateral.toFixed(4)," BTC"]}),e.jsxs("td",{className:"p-3 text-right",children:[t.principal_debt.toFixed(2)," MUSD"]}),e.jsxs("td",{className:"p-3 text-right text-sm text-muted-foreground",children:[t.interest.toFixed(2)," MUSD"]}),e.jsxs("td",{className:`p-3 text-right font-bold ${C(t.collaterization_ratio)}`,children:[(t.collaterization_ratio*100).toFixed(1),"%"]}),e.jsx("td",{className:"p-3 text-center",children:S(t.collaterization_ratio)}),e.jsx("td",{className:"p-3 text-center",children:e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>v(t.owner),className:"h-8 w-8",children:r.has(t.owner)?e.jsx(z,{className:"h-4 w-4 text-primary"}):e.jsx(_,{className:"h-4 w-4 text-muted-foreground"})})})]},t.id))})]}),d.length===0&&e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No troves found. Adjust filters or verify Supabase seed."})]})}),e.jsxs("div",{className:"space-y-3 md:hidden",children:[d.map(t=>e.jsxs("div",{className:"p-4 rounded-lg bg-card/30 border border-card-border/40",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"font-mono text-sm",children:F(t.owner)}),S(t.collaterization_ratio)]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm mb-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Collateral:"})," ",e.jsxs("span",{className:"font-medium",children:[t.collateral.toFixed(4)," BTC"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Debt:"})," ",e.jsxs("span",{className:"font-medium",children:[t.principal_debt.toFixed(2)," MUSD"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Interest:"})," ",e.jsxs("span",{children:[t.interest.toFixed(2)," MUSD"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"CR:"})," ",e.jsxs("span",{className:`font-bold ${C(t.collaterization_ratio)}`,children:[(t.collaterization_ratio*100).toFixed(1),"%"]})]})]}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>v(t.owner),className:"w-full gap-2",children:r.has(t.owner)?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4"}),"Remove from Watchlist"]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-4 w-4"}),"Add to Watchlist"]})})]},t.id)),d.length===0&&e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No troves found. Adjust filters or verify Supabase seed."})]})]})};export{G as AllTroves};
