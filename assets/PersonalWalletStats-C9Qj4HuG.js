import{j as e}from"./query-Df61bAsc.js";import{r as m}from"./react-uYZGv8Ap.js";import{C as $,B as x,b as C,m as p}from"./index-Cks0mafb.js";import{f as r}from"./formatNumber-BiSiC57o.js";import{W as E,E as F,a as P,g as W}from"./lucide-DvnUXODX.js";import"./recharts-wdVATIY2.js";import"./supabase-CskpBK-R.js";const _=t=>t.id||`${t.owner.toLowerCase()}-${t.collateral.toString()}-${t.interest.toLocaleString()}`,M=t=>t.length<=12?t:`${t.slice(0,6)}...${t.slice(-4)}`,j=t=>new Date(t).toLocaleString(void 0,{hour:"2-digit",minute:"2-digit",day:"numeric",month:"short"}),f=({message:t})=>e.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-dashed border-card-border/40 bg-muted/10 px-3 py-4 text-sm text-muted-foreground",children:[e.jsx(W,{className:"h-4 w-4 text-muted-foreground/70"}),t]}),Q=({troves:t,liquidations:b,redemptions:N,isLoading:k,wallet:T,onDebtCalculatorClick:v})=>{const{account:i,isConnecting:w,connect:A,disconnect:B}=T,l=(i==null?void 0:i.toLowerCase())??null,S=m.useMemo(()=>{const s=[...t].sort((o,c)=>{if(o.collaterization_ratio!==c.collaterization_ratio)return o.collaterization_ratio-c.collaterization_ratio;const D=new Date(o.updated_at).getTime(),y=new Date(c.updated_at).getTime();return D!==y?D-y:o.id.localeCompare(c.id)}),a=new Map;let n=0;return s.forEach((o,c)=>{a.set(_(o),{trovesAhead:c,collateralAhead:n}),n+=o.collateral}),a},[t]),d=m.useMemo(()=>l?t.filter(s=>s.owner.toLowerCase()===l):[],[t,l]),u=m.useMemo(()=>l?b.filter(s=>s.borrower.toLowerCase()===l):[],[b,l]),h=m.useMemo(()=>l?N.filter(s=>Array.isArray(s.affected_borrowers)&&s.affected_borrowers.some(a=>typeof a=="string"&&a.toLowerCase()===l)):[],[N,l]),z=m.useMemo(()=>d.reduce((s,a)=>s+a.collateral,0),[d]),L=m.useMemo(()=>d.reduce((s,a)=>s+a.principal_debt+a.interest,0),[d]),g=!!i,U=()=>e.jsxs("div",{className:"flex flex-col gap-3 rounded-2xl border border-card-border/40 bg-card/20 p-6 text-sm text-muted-foreground sm:flex-row sm:items-center",children:[e.jsx(P,{className:"h-5 w-5 text-primary"}),e.jsx("div",{children:"Connect with MetaMask, Rabby, or any EIP-1193 compatible wallet to view personalized trove, redemption, and liquidation data."})]}),R=()=>e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsx(p,{className:"h-32 rounded-2xl lg:col-span-2"}),e.jsx(p,{className:"h-32 rounded-2xl"}),e.jsx(p,{className:"h-32 rounded-2xl"})]});return e.jsxs($,{className:"glass-card p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"flex items-center gap-2 text-lg font-semibold text-primary",children:[e.jsx(E,{className:"h-5 w-5 text-primary"}),"Personal Wallet Stats"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:g?"Live data for the connected address.":"Connect to view details for your wallet."})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[i&&e.jsx(x,{variant:"outline",className:"justify-center font-mono text-xs uppercase",children:M(i)}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[i&&v&&e.jsx(C,{size:"sm",variant:"ghost",onClick:v,className:"border border-primary bg-transparent text-primary hover:bg-primary/10 hover:text-primary sm:order-1",children:"Debt calculator"}),e.jsx(C,{variant:i?"outline":"default",onClick:()=>i?B():void A(),disabled:w,children:i?"Disconnect":w?"Connecting...":"Connect wallet"})]})]})]}),!g&&U(),g&&e.jsx(e.Fragment,{children:k?R():e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs("div",{className:"rounded-2xl border border-card-border/40 bg-card/30 p-5 lg:col-span-2",children:[e.jsxs("div",{className:"mb-4 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground",children:"Current troves"}),e.jsx("p",{className:"text-2xl font-semibold",children:d.length>0?`${r(d.length)} active`:"No active troves"})]}),e.jsxs("div",{className:"grid w-full grid-cols-2 gap-3 text-sm sm:w-auto sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl border border-card-border/40 bg-background/60 p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Collateral"}),e.jsxs("p",{className:"text-lg font-semibold",children:[r(z,{minimumFractionDigits:4,maximumFractionDigits:4})," ","BTC"]})]}),e.jsxs("div",{className:"rounded-xl border border-card-border/40 bg-background/60 p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Debt"}),e.jsxs("p",{className:"text-lg font-semibold",children:[r(L,{minimumFractionDigits:2,maximumFractionDigits:2})," ","MUSD"]})]})]})]}),d.length===0?e.jsx(f,{message:"No troves found for this wallet."}):e.jsx("div",{className:"space-y-3",children:d.map(s=>{const a=_(s),n=S.get(a);return e.jsxs("div",{className:"rounded-xl border border-card-border/40 bg-background/50 p-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Updated ",j(s.updated_at)]}),e.jsxs(x,{variant:"secondary",className:"text-xs font-bold",children:[r(s.collaterization_ratio*100,{minimumFractionDigits:1,maximumFractionDigits:1}),"% CR"]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-4 text-sm md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Collateral"}),e.jsxs("p",{className:"font-semibold",children:[r(s.collateral,{minimumFractionDigits:4,maximumFractionDigits:4})," ","BTC"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Principal debt"}),e.jsxs("p",{className:"font-semibold",children:[r(s.principal_debt,{minimumFractionDigits:2,maximumFractionDigits:2})," ","MUSD"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Accrued interest"}),e.jsxs("p",{className:"font-semibold",children:[r(s.interest,{minimumFractionDigits:2,maximumFractionDigits:2})," ","MUSD"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Owner"}),e.jsx("p",{className:"font-mono text-xs",children:M(s.owner)})]})]}),e.jsxs("div",{className:"mt-4 rounded-xl border border-card-border/60 bg-card/20 p-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Redemption position"}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Troves ahead"}),e.jsx("p",{className:"text-xl font-semibold",children:r((n==null?void 0:n.trovesAhead)??0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"BTC ahead"}),e.jsxs("p",{className:"text-xl font-semibold",children:[r((n==null?void 0:n.collateralAhead)??0,{minimumFractionDigits:4,maximumFractionDigits:4})," ","BTC"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground sm:max-w-xs",children:"Troves are redeemed in order of collateral ratio. Fewer troves and BTC ahead indicate higher redemption risk."})]})]})]},a)})})]}),e.jsxs("div",{className:"rounded-2xl border border-card-border/40 bg-card/30 p-5",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Recent redemptions"}),e.jsx(x,{variant:"secondary",children:r(h.length)})]}),h.length===0?e.jsx(f,{message:"No redemptions affecting this wallet."}):e.jsx("div",{className:"space-y-3",children:h.slice(0,5).map(s=>e.jsxs("div",{className:"rounded-xl border border-card-border/40 bg-background/50 p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:j(s.block_timestamp)}),e.jsxs("button",{className:"inline-flex items-center gap-1 text-primary hover:underline",onClick:()=>window.open(`https://explorer.mezo.org/tx/${s.tx_hash}`,"_blank"),children:["View",e.jsx(F,{className:"h-3 w-3"})]})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Attempted"}),e.jsxs("p",{className:"font-semibold",children:[r(s.attempted_amount,{minimumFractionDigits:2,maximumFractionDigits:2})," ","MUSD"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Actual"}),e.jsxs("p",{className:"font-semibold",children:[r(s.actual_amount,{minimumFractionDigits:2,maximumFractionDigits:2})," ","MUSD"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Collateral sent"}),e.jsxs("p",{className:"font-semibold",children:[r(s.collateral_sent,{minimumFractionDigits:4,maximumFractionDigits:4})," ","BTC"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Fee"}),e.jsxs("p",{className:"font-semibold",children:[r(s.collateral_fee,{minimumFractionDigits:4,maximumFractionDigits:4})," ","BTC"]})]})]})]},s.id))})]}),e.jsxs("div",{className:"rounded-2xl border border-card-border/40 bg-card/30 p-5",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Recent liquidations"}),e.jsx(x,{variant:"secondary",children:r(u.length)})]}),u.length===0?e.jsx(f,{message:"No liquidations for this wallet."}):e.jsx("div",{className:"space-y-3",children:u.slice(0,5).map(s=>e.jsxs("div",{className:"rounded-xl border border-card-border/40 bg-background/50 p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:j(s.block_timestamp)}),e.jsxs("button",{className:"inline-flex items-center gap-1 text-primary hover:underline",onClick:()=>window.open(`https://explorer.mezo.org/tx/${s.tx_hash}`,"_blank"),children:["View",e.jsx(F,{className:"h-3 w-3"})]})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Debt repaid"}),e.jsxs("p",{className:"font-semibold",children:[r(s.debt,{minimumFractionDigits:2,maximumFractionDigits:2})," ","MUSD"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Collateral"}),e.jsxs("p",{className:"font-semibold",children:[r(s.collateral,{minimumFractionDigits:4,maximumFractionDigits:4})," ","BTC"]})]})]})]},s.id))})]})]})})]})};export{Q as PersonalWalletStats};
