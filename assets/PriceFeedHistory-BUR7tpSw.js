import{j as e}from"./query-CpGXJd7o.js";import{r as f}from"./react-uYZGv8Ap.js";import{C as $,a as B,A as H,b as M,d as F,B as _}from"./index-B47aSfAA.js";import{T as E,a as R,b as I,c as D}from"./tabs-DAycHYDm.js";import{u as G}from"./usePriceFeedHistory-BPnpyq36.js";import{d as K,e as O,f as Y,b as z,c as V}from"./lucide-B1F32fvT.js";import{R as X,L as W,C as q,X as J,Y as Q,T as Z,a as ee}from"./recharts-CblCIUsG.js";import"./supabase-CskpBK-R.js";const S="mezo-chart-collapse-price-feed",d=[{value:"musd-1d",label:"MUSD feed · 24H",source:"musd_usdc",hours:24,limit:300,priceDivisor:1e5,heading:"MUSD / USDC 100k sell order (Last 24 Hours)",changeLabel:"24h Change",highLabel:"24h High",lowLabel:"24h Low",emptyMessage:"No price feed updates recorded in the last 24 hours."},{value:"musd-30d",label:"MUSD feed · 30D",source:"musd_usdc_4h",hours:24/4*30,limit:300,priceDivisor:1e5,heading:"MUSD / USDC 100k sell order (Last 30 Days)",changeLabel:"30d Change",highLabel:"30d High",lowLabel:"30d Low",emptyMessage:"No price feed updates recorded in the last 30 days."},{value:"btc",label:"BTC feed · 24H",source:"btc_oracle",hours:24,limit:300,heading:"BTC Price Feed (Last 24 Hours)",changeLabel:"24h Change",highLabel:"24h High",lowLabel:"24h Low",emptyMessage:"No BTC price feed updates recorded in the past 4 hours."}],x=t=>{const s=Math.abs(t);return s>=1e3?{min:0,max:0}:s>=10?{min:2,max:2}:s>=1?{min:2,max:4}:s>=.01?{min:4,max:6}:{min:6,max:6}},b=t=>{if(t===null||Number.isNaN(t))return"—";const{min:s,max:r}=x(t);return`$${t.toLocaleString("en-US",{minimumFractionDigits:s,maximumFractionDigits:r})}`},te=t=>{const{min:s,max:r}=x(t);return`$${t.toLocaleString("en-US",{minimumFractionDigits:s,maximumFractionDigits:r})}`},se=t=>{const{max:s}=x(t);return`$${t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:Math.max(0,s)})}`},k=(t,s)=>{if(t===null||s===null||Number.isNaN(t)||Number.isNaN(s))return"—";const r=t>0?"+":t<0?"−":"",o=Math.abs(t),{min:a,max:i}=x(o),c=Math.abs(s);return`${r}$${o.toLocaleString("en-US",{minimumFractionDigits:a,maximumFractionDigits:i})} (${r}${c.toFixed(2)}%)`},T=t=>t?new Date(t).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):null,re=(t,s)=>{const r=new Date(t);return Number.isNaN(r.getTime())?"":s>=24*14?r.toLocaleDateString([],{month:"short",day:"numeric"}):s>=24?r.toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},g=({label:t,value:s,helper:r,accent:o})=>{const a=o==="positive"?"text-safe":o==="negative"?"text-critical":"text-foreground";return e.jsxs("div",{className:"p-4 rounded-xl bg-card/40 border border-border/40",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.08em] text-muted-foreground mb-1",children:t}),e.jsx("div",{className:F("text-2xl font-semibold",a),children:s}),r?e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:r}):null]})},ae=({tab:t,isChartCollapsed:s,onToggleChart:r})=>{const{pricePoints:o,stats:a,isLoading:i,isFetching:c,error:u}=G({source:t.source,hours:t.hours,limit:t.limit}),v=t.priceDivisor??1,h=n=>n===null?null:n/v,P=h(a.latestPrice),l=h(a.change),U=h(a.high),A=h(a.low),N=o.map(n=>({time:re(n.timestamp,t.hours),price:n.price/v,blockNumber:n.blockNumber,timestamp:n.timestamp}));if(i&&o.length===0)return e.jsx(D,{value:t.value,className:"mt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("div",{className:"h-6 w-32 rounded bg-muted/20 animate-pulse"}),e.jsx("div",{className:"h-6 w-20 rounded bg-muted/20 animate-pulse"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:Array.from({length:4}).map((n,m)=>e.jsx("div",{className:"h-20 bg-muted/20 animate-pulse rounded-xl"},m))}),e.jsx("div",{className:"h-64 bg-muted/20 animate-pulse rounded-xl"})]})});const j=l&&l!==0?l>0?"positive":"negative":void 0,w=l&&l!==0?l>0?O:Y:null,L=T(a.lastUpdated);return e.jsxs(D,{value:t.value,className:"mt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[a.latestBlockNumber!==null&&e.jsxs(B,{variant:"outline",className:"border-primary/40 text-primary",children:["Block ",a.latestBlockNumber.toLocaleString()]}),u?null:c?e.jsx("span",{className:"animate-pulse",children:"Updating…"}):L?e.jsxs("span",{children:["Updated ",L]}):null]}),u?e.jsx(H,{variant:"destructive",className:"mt-4",children:e.jsxs(M,{children:["Unable to load price feed history: ",u.message]})}):null,e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-6",children:[e.jsx(g,{label:"Latest Price",value:b(P),helper:"Oracle price"}),e.jsx(g,{label:t.changeLabel,value:k(l,a.percentChange),helper:"Net move over the window",accent:j}),e.jsx(g,{label:t.highLabel,value:b(U),helper:"Peak oracle price"}),e.jsx(g,{label:t.lowLabel,value:b(A),helper:"Trough oracle price"})]}),e.jsxs("div",{className:"bg-card/40 rounded-xl p-4 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Oracle Price by Block"}),e.jsxs("div",{className:"flex items-center gap-2",children:[w?e.jsxs("div",{className:F("inline-flex items-center gap-1 text-xs font-medium",j==="positive"?"text-safe":"text-critical"),children:[e.jsx(w,{className:"h-4 w-4"}),k(l,a.percentChange)]}):null,e.jsxs(_,{type:"button",variant:"ghost",size:"icon",className:"h-7 w-7",onClick:r,children:[s?e.jsx(z,{className:"h-4 w-4"}):e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:s?"Show chart":"Hide chart"})]})]})]}),s?e.jsx("div",{className:"text-xs text-muted-foreground",children:"Chart hidden."}):u?null:N.length>0?e.jsx(X,{width:"100%",height:260,children:e.jsxs(W,{data:N,children:[e.jsx(q,{strokeDasharray:"3 3",stroke:"hsl(var(--border))",opacity:.3}),e.jsx(J,{dataKey:"time",stroke:"hsl(var(--muted-foreground))",tick:{fill:"hsl(var(--muted-foreground))"},tickLine:!1,minTickGap:20}),e.jsx(Q,{stroke:"hsl(var(--muted-foreground))",tick:{fill:"hsl(var(--muted-foreground))"},tickLine:!1,domain:["auto","auto"],tickFormatter:se}),e.jsx(Z,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--foreground))"},labelFormatter:(n,m)=>{var y;const p=(y=m==null?void 0:m[0])==null?void 0:y.payload;if(!p)return"";const C=T(p.timestamp);return C?`${C} • Block ${p.blockNumber.toLocaleString()}`:""},formatter:n=>[te(n),"Price"]}),e.jsx(ee,{type:"monotone",dataKey:"price",stroke:"hsl(var(--primary))",strokeWidth:2,dot:!1,activeDot:{r:5}})]})}):e.jsx("div",{className:"flex items-center justify-center h-52 text-sm text-muted-foreground",children:t.emptyMessage})]})]})},he=()=>{const[t,s]=f.useState(d[0].value),[r,o]=f.useState(()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem(S)==="true"}catch{return!1}}),a=d.find(i=>i.value===t)??d[0];return f.useEffect(()=>{try{window.localStorage.setItem(S,String(r))}catch{}},[r]),e.jsx($,{className:"glass-card p-6",children:e.jsxs(E,{value:t,onValueChange:s,children:[e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[e.jsx(K,{className:"h-5 w-5"}),e.jsx("h2",{className:"text-lg font-semibold",children:a.heading})]}),e.jsx(R,{className:"order-last -mx-1 flex flex-nowrap items-center gap-2 overflow-x-auto bg-transparent p-0 lg:order-none lg:mx-0 lg:flex-wrap lg:bg-muted/10 lg:p-1",children:d.map(i=>e.jsx(I,{value:i.value,className:"flex-none whitespace-nowrap px-3 py-2 text-xs sm:text-sm",children:i.label},i.value))})]}),d.map(i=>e.jsx(ae,{tab:i,isChartCollapsed:r,onToggleChart:()=>o(c=>!c)},i.value))]})})};export{he as PriceFeedHistory};
