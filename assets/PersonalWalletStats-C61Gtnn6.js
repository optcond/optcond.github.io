import{j as e}from"./query-CpGXJd7o.js";import{r as o}from"./react-uYZGv8Ap.js";import{u as O,j as V,M as G,k as H,l as B,C as J,g as k,B as j,W as Q,f as r,m as X,n as Y,o as Z,S as b}from"./index-CiyeXEvp.js";import{W as ee,I as se,E as S,d as te}from"./lucide-BHKD0XH8.js";import"./supabase-CskpBK-R.js";import"./recharts-CblCIUsG.js";const re=1.1,L=t=>t.id||`${t.owner.toLowerCase()}-${t.collateral.toString()}-${t.interest.toLocaleString()}`,ae=t=>t.length<=12?t:`${t.slice(0,6)}...${t.slice(-4)}`,N=t=>new Date(t).toLocaleString(void 0,{hour:"2-digit",minute:"2-digit",day:"numeric",month:"short"}),v=({message:t})=>e.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-dashed border-card-border/40 bg-muted/10 px-3 py-4 text-sm text-muted-foreground",children:[e.jsx(te,{className:"h-4 w-4 text-muted-foreground/70"}),t]}),ue=({troves:t,liquidations:w,redemptions:D,isLoading:A,wallet:z,onDebtCalculatorClick:y})=>{var T;const{account:a}=z,l=(a==null?void 0:a.toLowerCase())??null,x=O()??G.id,U=((T=o.useMemo(()=>V(x),[x]).tokens)==null?void 0:T.MUSD.address)??H.MUSD.address,{data:u,isFetching:$}=B({address:a||void 0,chainId:x,query:{enabled:!!a,refetchInterval:a?3e4:!1}}),{data:h,isFetching:I}=B({address:a||void 0,chainId:x,token:U,query:{enabled:!!a,refetchInterval:a?3e4:!1}}),[g,C]=o.useState("redemptions"),R=o.useMemo(()=>{const s=[...t].sort((c,m)=>{if(c.collaterization_ratio!==m.collaterization_ratio)return c.collaterization_ratio-m.collaterization_ratio;const M=new Date(c.updated_at).getTime(),_=new Date(m.updated_at).getTime();return M!==_?M-_:c.id.localeCompare(m.id)}),i=new Map;let n=0;return s.forEach((c,m)=>{i.set(L(c),{trovesAhead:m,collateralAhead:n}),n+=c.collateral}),i},[t]),d=o.useMemo(()=>l?t.filter(s=>s.owner.toLowerCase()===l):[],[t,l]),p=o.useMemo(()=>l?w.filter(s=>s.borrower.toLowerCase()===l):[],[w,l]),f=o.useMemo(()=>l?D.filter(s=>Array.isArray(s.affected_borrowers)&&s.affected_borrowers.some(i=>typeof i=="string"&&i.toLowerCase()===l)):[],[D,l]),E=o.useMemo(()=>d.reduce((s,i)=>s+i.collateral,0),[d]),W=o.useMemo(()=>d.reduce((s,i)=>s+i.principal_debt+i.interest,0),[d]),F=!!a,q=a?$?"Fetching…":u?`${Number(u.formatted).toLocaleString(void 0,{maximumFractionDigits:4})} ${u.symbol??"BTC"}`:"0 BTC":"Connect wallet",P=a?I?"Fetching…":h?`${Number(h.formatted).toLocaleString(void 0,{maximumFractionDigits:2})} ${h.symbol??"MUSD"}`:"0 MUSD":"Connect wallet",K=()=>e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[1.6fr_1fr]",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{className:"h-16 rounded-2xl"}),e.jsx(b,{className:"h-80 rounded-2xl"})]}),e.jsx(b,{className:"h-[420px] rounded-2xl"})]});return e.jsxs(J,{className:"glass-card p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"flex items-center gap-2 text-lg font-semibold text-primary",children:[e.jsx(ee,{className:"h-5 w-5 text-primary"}),"Personal Wallet Stats"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:F?"Live data for the connected address.":"Connect to view details for your wallet."})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[a&&e.jsx(k,{variant:"outline",className:"justify-center font-mono text-xs uppercase",children:ae(a)}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[a&&y&&e.jsx(j,{size:"sm",variant:"ghost",onClick:y,className:"border border-primary bg-transparent text-primary hover:bg-primary/10 hover:text-primary sm:order-1",children:"Debt calculator"}),e.jsx(Q,{})]})]})]}),F&&e.jsx(e.Fragment,{children:A?K():e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[1.6fr_1fr]",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-2xl border border-card-border/40 bg-card/20 px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-6 text-sm",children:[e.jsxs("div",{className:"min-w-[140px]",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"BTC"}),e.jsx("p",{className:"text-base font-semibold text-foreground",children:q})]}),e.jsxs("div",{className:"min-w-[140px]",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"MUSD"}),e.jsx("p",{className:"text-base font-semibold text-foreground",children:P})]})]})}),e.jsxs("div",{className:"rounded-2xl border border-card-border/40 bg-card/30 p-5",children:[e.jsxs("div",{className:"mb-4 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground",children:"Current troves"}),e.jsx("p",{className:"text-2xl font-semibold",children:d.length>0?`${r(d.length)} active`:"No active troves"})]}),e.jsxs("div",{className:"grid w-full grid-cols-2 gap-3 text-sm sm:w-auto sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl border border-card-border/40 bg-background/60 p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Collateral"}),e.jsxs("p",{className:"text-lg font-semibold",children:[r(E,{minimumFractionDigits:4,maximumFractionDigits:4})," ","BTC"]})]}),e.jsxs("div",{className:"rounded-xl border border-card-border/40 bg-background/60 p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Debt"}),e.jsxs("p",{className:"text-lg font-semibold",children:[r(W,{minimumFractionDigits:2,maximumFractionDigits:2})," ","MUSD"]})]})]})]}),d.length===0?e.jsx(v,{message:"No troves found for this wallet."}):e.jsx("div",{className:"space-y-3",children:d.map(s=>{const i=L(s),n=R.get(i);return e.jsxs("div",{className:"rounded-xl border border-card-border/40 bg-background/50 p-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Updated ",N(s.updated_at)]}),e.jsxs(k,{variant:"secondary",className:"text-xs font-bold",children:[r(s.collaterization_ratio*100,{minimumFractionDigits:1,maximumFractionDigits:1}),"% CR"]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-4 text-sm md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Collateral"}),e.jsxs("p",{className:"font-semibold",children:[r(s.collateral,{minimumFractionDigits:4,maximumFractionDigits:4})," ","BTC"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Principal debt"}),e.jsxs("p",{className:"font-semibold",children:[r(s.principal_debt,{minimumFractionDigits:2,maximumFractionDigits:2})," ","MUSD"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Accrued interest"}),e.jsxs("p",{className:"font-semibold",children:[r(s.interest,{minimumFractionDigits:2,maximumFractionDigits:2})," ","MUSD"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Liquidation price"}),e.jsx("p",{className:"font-semibold",children:s.collateral>0?`$${r((s.principal_debt+s.interest)*re/s.collateral,{minimumFractionDigits:2,maximumFractionDigits:2})}`:"—"})]})]}),e.jsxs("div",{className:"mt-4 rounded-xl border border-card-border/60 bg-card/20 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs uppercase tracking-wide text-muted-foreground",children:[e.jsx("span",{children:"Redemption position"}),e.jsxs(X,{delayDuration:150,children:[e.jsx(Y,{asChild:!0,children:e.jsx("button",{type:"button",className:"text-muted-foreground/70 transition hover:text-muted-foreground","aria-label":"Redemption position details",children:e.jsx(se,{className:"h-3.5 w-3.5"})})}),e.jsx(Z,{side:"top",className:"max-w-xs normal-case",children:"Troves are redeemed in order of collateral ratio. Fewer troves and BTC ahead indicate higher redemption risk."})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Troves ahead"}),e.jsx("p",{className:"text-xl font-semibold",children:r((n==null?void 0:n.trovesAhead)??0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"BTC ahead"}),e.jsxs("p",{className:"text-xl font-semibold",children:[r((n==null?void 0:n.collateralAhead)??0,{minimumFractionDigits:4,maximumFractionDigits:4})," ","BTC"]})]})]})]})]},i)})})]})]}),e.jsxs("div",{className:"rounded-2xl border border-card-border/40 bg-card/30 p-5",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsx("p",{className:"text-xs uppercase text-muted-foreground",children:"Activity"})}),e.jsxs("div",{className:"flex items-center gap-1 rounded-full border border-card-border/50 bg-background/60 p-1",children:[e.jsxs(j,{size:"sm",variant:g==="redemptions"?"secondary":"ghost",className:"h-8 rounded-full px-3 text-xs",onClick:()=>C("redemptions"),children:["Redemptions (",r(f.length),")"]}),e.jsxs(j,{size:"sm",variant:g==="liquidations"?"secondary":"ghost",className:"h-8 rounded-full px-3 text-xs",onClick:()=>C("liquidations"),children:["Liquidations (",r(p.length),")"]})]})]}),e.jsx("div",{className:"mt-4 space-y-3",children:g==="redemptions"?f.length===0?e.jsx(v,{message:"No redemptions affecting this wallet."}):f.slice(0,5).map(s=>e.jsxs("div",{className:"rounded-xl border border-card-border/40 bg-background/50 p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:N(s.block_timestamp)}),e.jsxs("button",{className:"inline-flex items-center gap-1 text-primary hover:underline",onClick:()=>window.open(`https://explorer.mezo.org/tx/${s.tx_hash}`,"_blank"),children:["View",e.jsx(S,{className:"h-3 w-3"})]})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Attempted"}),e.jsxs("p",{className:"font-semibold",children:[r(s.attempted_amount,{minimumFractionDigits:2,maximumFractionDigits:2})," ","MUSD"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Actual"}),e.jsxs("p",{className:"font-semibold",children:[r(s.actual_amount,{minimumFractionDigits:2,maximumFractionDigits:2})," ","MUSD"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Collateral sent"}),e.jsxs("p",{className:"font-semibold",children:[r(s.collateral_sent,{minimumFractionDigits:4,maximumFractionDigits:4})," ","BTC"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Fee"}),e.jsxs("p",{className:"font-semibold",children:[r(s.collateral_fee,{minimumFractionDigits:4,maximumFractionDigits:4})," ","BTC"]})]})]})]},s.id)):p.length===0?e.jsx(v,{message:"No liquidations for this wallet."}):p.slice(0,5).map(s=>e.jsxs("div",{className:"rounded-xl border border-card-border/40 bg-background/50 p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:N(s.block_timestamp)}),e.jsxs("button",{className:"inline-flex items-center gap-1 text-primary hover:underline",onClick:()=>window.open(`https://explorer.mezo.org/tx/${s.tx_hash}`,"_blank"),children:["View",e.jsx(S,{className:"h-3 w-3"})]})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Debt repaid"}),e.jsxs("p",{className:"font-semibold",children:[r(s.debt,{minimumFractionDigits:2,maximumFractionDigits:2})," ","MUSD"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Collateral"}),e.jsxs("p",{className:"font-semibold",children:[r(s.collateral,{minimumFractionDigits:4,maximumFractionDigits:4})," ","BTC"]})]})]})]},s.id))})]})]})})]})};export{ue as PersonalWalletStats};
