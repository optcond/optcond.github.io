import{j as e}from"./query-CpGXJd7o.js";import{r as m}from"./react-uYZGv8Ap.js";import{C as x,B as b,A as C,h as N}from"./index-CJ40OxjP.js";import{S as w,O as u,T as y,g as k,h as R,i as S,b as A,c as T}from"./lucide-CVS_0vIr.js";import{R as E,P as $,b as H,c as I,T as B,d as D}from"./recharts-CblCIUsG.js";import"./supabase-CskpBK-R.js";const j="mezo-chart-collapse-risk-analysis",c=({title:s,count:a,collateral:l,description:r,icon:n,color:t,iconColor:d})=>e.jsxs("div",{className:`p-4 rounded-xl bg-card/40 border-l-4 ${t}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-semibold",children:s}),e.jsx(n,{className:`h-5 w-5 ${d}`})]}),e.jsx("div",{className:"text-2xl font-bold mb-1",children:a}),e.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:[l.toFixed(4)," BTC"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:r})]}),q=({critical:s,high:a,elevated:l,safe:r,isLoading:n})=>{const[t,d]=m.useState(()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem(j)==="true"}catch{return!1}});m.useEffect(()=>{try{window.localStorage.setItem(j,String(t))}catch{}},[t]);const h=[{name:"Critical <1.2",value:s.count,color:"hsl(var(--critical))"},{name:"High 1.2-1.6",value:a.count,color:"hsl(var(--high))"},{name:"Elevated 1.6-2.0",value:l.count,color:"hsl(var(--elevated))"},{name:"Safe ≥2.0",value:r.count,color:"hsl(var(--safe))"}];return n?e.jsxs(x,{className:"glass-card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Risk Analysis"}),e.jsx("div",{className:"h-64 bg-muted/20 animate-pulse rounded-xl"})]}):e.jsxs(x,{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-primary",children:[e.jsx(w,{className:"h-5 w-5 text-high"}),"Risk Analysis"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(c,{title:"Critical <1.2",count:s.count,collateral:s.collateral,description:"Immediate liquidation risk",icon:u,color:"border-critical",iconColor:"text-critical"}),e.jsx(c,{title:"High 1.2–1.6",count:a.count,collateral:a.collateral,description:"High risk threshold",icon:y,color:"border-high",iconColor:"text-high"}),e.jsx(c,{title:"Elevated 1.6–2.0",count:l.count,collateral:l.collateral,description:"Moderate risk level",icon:k,color:"border-elevated",iconColor:"text-elevated"}),e.jsx(c,{title:"Safe ≥2.0",count:r.count,collateral:r.collateral,description:"Low risk level",icon:R,color:"border-safe",iconColor:"text-safe"})]}),e.jsxs("div",{className:"bg-card/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4"}),"Risk Distribution"]}),e.jsxs(b,{type:"button",variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>d(o=>!o),children:[t?e.jsx(A,{className:"h-4 w-4"}):e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:t?"Show chart":"Hide chart"})]})]}),t?e.jsx("div",{className:"text-xs text-muted-foreground",children:"Chart hidden."}):e.jsx(E,{width:"100%",height:240,children:e.jsxs($,{children:[e.jsx(H,{data:h,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"value",children:h.map((o,i)=>e.jsx(I,{fill:o.color},`cell-${i}`))}),e.jsx(B,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}}),e.jsx(D,{verticalAlign:"bottom",height:36,formatter:(o,i)=>{const p=h.reduce((f,g)=>f+g.value,0),v=(i.payload.value/p*100).toFixed(1);return`${o}: ${i.payload.value} (${v}%)`}})]})})]}),s.count>0&&e.jsxs(C,{variant:"destructive",className:"mt-6",children:[e.jsx(u,{className:"h-4 w-4 text-critical"}),e.jsxs(N,{children:[s.count," trove",s.count>1?"s":""," below 1.2 CR with ",s.collateral.toFixed(4)," BTC at risk of liquidation"]})]})]})};export{q as RiskAnalysis};
