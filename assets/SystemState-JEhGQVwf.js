import{j as e}from"./query-CpGXJd7o.js";import{r as u}from"./react-uYZGv8Ap.js";import{C as x,f as v,B as y}from"./index-BhHvaXEV.js";import{u as N}from"./usePriceFeedHistory-CEjryIK5.js";import{L as S,U as w,C as T,a as h,G as D,A as k,b as L,c as F}from"./lucide-DpEOl3rZ.js";import{R,L as $,C as A,X as U,Y as E,T as P,a as B}from"./recharts-CblCIUsG.js";import"./supabase-CskpBK-R.js";const b="mezo-chart-collapse-system-state",t=({label:a,value:o,subtitle:l,borderColor:d,icon:i})=>e.jsxs("div",{className:`relative w-full p-4 rounded-xl bg-card/40 border-l-4 ${d} min-w-[180px]`,children:[i&&e.jsx(i,{className:"absolute top-3 right-3 h-5 w-5 text-muted-foreground/40"}),e.jsx("div",{className:"text-sm text-muted-foreground mb-1",children:a}),e.jsx("div",{className:"text-2xl font-bold mb-1",children:o}),e.jsx("div",{className:"text-xs text-muted-foreground",children:l})]}),M=({tcr:a,tcrMinus10:o,totalCollateral:l,totalDebt:d,totalTroves:i,chartData:p,isLoading:f})=>{const{stats:c}=N({source:"musd_usdc",hours:24,limit:300}),n=c.latestPrice!==null?c.latestPrice/1e5:null,g=n!==null&&Number.isFinite(n)?`$${n.toLocaleString(void 0,{minimumFractionDigits:4,maximumFractionDigits:4})}`:"â€”",[s,j]=u.useState(()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem(b)==="true"}catch{return!1}});u.useEffect(()=>{try{window.localStorage.setItem(b,String(s))}catch{}},[s]);const m=r=>r<1.2?"border-critical":r<1.6?"border-high":r<2?"border-elevated":"border-primary";return f?e.jsxs(x,{className:"glass-card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"System State"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-24 bg-muted/20 animate-pulse rounded-xl"}),e.jsx("div",{className:"h-64 bg-muted/20 animate-pulse rounded-xl"})]})]}):e.jsxs(x,{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-primary",children:[e.jsx(S,{className:"h-5 w-5 text-primary"}),"System State"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 mb-6 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(t,{label:"Total Troves",value:i.toLocaleString(),subtitle:"Active positions",borderColor:"border-primary",icon:w}),e.jsx(t,{label:"Total Collateral",value:`${l.toFixed(2)} BTC`,subtitle:"System-wide",borderColor:"border-primary",icon:T}),e.jsx(t,{label:"Total Debt",value:`${v(d,{minimumFractionDigits:2,maximumFractionDigits:2})} MUSD`,subtitle:"System-wide",borderColor:"border-primary",icon:h}),e.jsx(t,{label:"TCR",value:`${(a*100).toFixed(1)}%`,subtitle:"Total Collateral Ratio",borderColor:m(a),icon:D}),e.jsx(t,{label:"TCR -10%",value:`${(o*100).toFixed(1)}%`,subtitle:"10% price drop",borderColor:m(o),icon:k}),e.jsx(t,{label:"MUSD / USDC",value:g,subtitle:"Latest price",borderColor:"border-primary",icon:h})]}),e.jsxs("div",{className:"bg-card/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"30-Day TCR History"}),e.jsxs(y,{type:"button",variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>j(r=>!r),children:[s?e.jsx(L,{className:"h-4 w-4"}):e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:s?"Show chart":"Hide chart"})]})]}),s?e.jsx("div",{className:"text-xs text-muted-foreground",children:"Chart hidden."}):e.jsx(R,{width:"100%",height:240,children:e.jsxs($,{data:p,children:[e.jsx(A,{strokeDasharray:"3 3",stroke:"hsl(var(--border))",opacity:.3}),e.jsx(U,{dataKey:"date",stroke:"hsl(var(--muted-foreground))",tick:{fill:"hsl(var(--muted-foreground))"},tickLine:!1}),e.jsx(E,{stroke:"hsl(var(--muted-foreground))",tick:{fill:"hsl(var(--muted-foreground))"},tickLine:!1,domain:[r=>r*.9,r=>r*1.1],tickFormatter:r=>r.toFixed(2)}),e.jsx(P,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px",color:"hsl(var(--foreground))"},formatter:(r,C)=>C==="tcr"?[`${(r*100).toFixed(2)}%`,"TCR"]:[`$${r.toLocaleString()}`,"BTC Price"]}),e.jsx(B,{type:"monotone",dataKey:"tcr",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{fill:"hsl(var(--primary))",r:4},activeDot:{r:6}})]})})]})]})};export{M as SystemState};
